{% extends "admin_base.html" %}

{% block title %}Clientes - Admin Booker{% endblock %}

{% block content %}
<div class="card">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h2>ğŸ¢ Clientes</h2>
        <a href="{{ url_for('novo_cliente') }}" class="btn btn-primary">â• Novo Cliente</a>
    </div>

    <!-- Filtros -->
    <form method="get" class="filters">
        <div class="form-row">
            <div class="form-group">
                <input type="text" name="busca" placeholder="ğŸ” Buscar por CNPJ/CPF ou nome..." 
                       value="{{ filtros.busca if filtros.busca else '' }}"
                       style="margin-bottom: 0;">
            </div>
            <div class="form-group">
                <select name="grupo" style="margin-bottom: 0;">
                    <option value="">ğŸ—‚ï¸ Todos os Grupos</option>
                    {% for g in grupos %}
                    <option value="{{ g }}" {% if filtros.grupo == g %}selected{% endif %}>
                        {{ g }}
                    </option>
                    {% endfor %}
                </select>
            </div>
            <div style="display: flex; gap: 10px;">
                <button type="submit" class="btn btn-primary">Buscar</button>
                <a href="{{ url_for('listar_clientes') }}" class="btn btn-secondary">Limpar</a>
            </div>
        </div>
    </form>

    <!-- Tabela -->
    {% if clientes %}
    <div class="table-wrapper">
        <table>
            <thead>
                <tr>
                    <th>CNPJ/CPF</th>
                    <th>Nome do Cliente</th>
                    <th>CÃ³digo Grupo</th>
                    <th>DescriÃ§Ã£o Grupo</th>
                    <th style="width: 200px; text-align: center;">AÃ§Ãµes</th>
                </tr>
            </thead>
            <tbody>
                {% for cliente in clientes %}
                <tr>
                    <td><strong>{{ cliente.num_cnpj_cpf }}</strong></td>
                    <td>{{ cliente.nom_cliente }}</td>
                    <td style="text-align: center;">{{ cliente.cod_grupo_cliente }}</td>
                    <td>
                        {% if cliente.des_grupo and cliente.des_grupo != 'SEM GRUPO' %}
                            <span class="badge badge-info">{{ cliente.des_grupo }}</span>
                        {% else %}
                            <span style="color: #999;">Sem grupo</span>
                        {% endif %}
                    </td>
                    <td>
                        <div class="actions" style="justify-content: center;">
                            <a href="{{ url_for('editar_cliente', id=cliente.id) }}" 
                               class="btn btn-sm btn-secondary">âœï¸ Editar</a>
                            <button onclick="deletarCliente({{ cliente.id }})" 
                                    class="btn btn-sm btn-danger">ğŸ—‘ï¸ Deletar</button>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <p style="margin-top: 15px; color: #666; font-size: 14px;">
        ğŸ“Š Total de clientes: <strong>{{ clientes|length }}</strong>
    </p>
    {% else %}
    <div class="empty-state">
        <h3>Nenhum cliente encontrado</h3>
        <p>Adicione novos clientes para gerenciar suas tarefas.</p>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block scripts %}
<script>
function deletarCliente(id) {
    if (!confirm('Tem certeza que deseja deletar este cliente?')) {
        return;
    }
    
    fetch('/clientes/deletar/' + id, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert(data.message);
            location.reload();
        } else {
            alert('âŒ ' + data.message);
        }
    })
    .catch(error => {
        alert('âŒ Erro ao deletar cliente: ' + error);
    });
}
</script>
{% endblock %}