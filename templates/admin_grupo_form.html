{% extends "admin_base.html" %}

{% block title %}{{ 'Editar' if grupo else 'Novo' }} Grupo - Admin Booker{% endblock %}

{% block content %}
<div class="card">
    <h2>{{ '‚úèÔ∏è Editar' if grupo else '‚ûï Novo' }} Grupo de Tarefas</h2>
    
    {% if grupo and total_tarefas %}
    <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #ffc107;">
        <strong>‚ö†Ô∏è Aten√ß√£o:</strong> Este grupo possui <strong>{{ total_tarefas }}</strong> tarefa(s) vinculada(s).
        <br>Se voc√™ alterar o c√≥digo, as tarefas ser√£o atualizadas automaticamente.
    </div>
    {% endif %}

    <form method="POST" onsubmit="return validarFormulario()">
        <div class="form-row">
            <div class="form-group">
                <label for="cod_grupo_tarefa">C√≥digo do Grupo *</label>
                <input type="text" 
                       id="cod_grupo_tarefa" 
                       name="cod_grupo_tarefa" 
                       value="{{ grupo.cod_grupo_tarefa if grupo else '' }}"
                       required
                       maxlength="20">
                <small>Exemplo: CONT-2024, FIS, RH-01, 1.01</small>
            </div>

            <div class="form-group">
                <label for="nome_grupo_tarefa">Nome do Grupo *</label>
                <input type="text" 
                       id="nome_grupo_tarefa" 
                       name="nome_grupo_tarefa" 
                       value="{{ grupo.nome_grupo_tarefa if grupo else '' }}"
                       required
                       maxlength="100">
                <small>Nome descritivo do grupo de tarefas</small>
            </div>
        </div>

        <div class="form-group">
            <label for="departamento">Departamento</label>
            <input type="text" 
                   id="departamento" 
                   name="departamento" 
                   value="{{ grupo.departamento if grupo and grupo.departamento else '' }}"
                   list="departamentos-list"
                   maxlength="100"
                   placeholder="Ex: Contabilidade, Fiscal, RH...">
            <datalist id="departamentos-list">
                {% for dept in departamentos %}
                <option value="{{ dept }}">
                {% endfor %}
            </datalist>
            <small>Departamento ao qual este grupo de tarefas pertence (opcional)</small>
        </div>

        <div style="display: flex; gap: 15px; margin-top: 30px;">
            <button type="submit" class="btn btn-success">
                {{ 'üíæ Salvar Altera√ß√µes' if grupo else '‚ûï Cadastrar Grupo' }}
            </button>
            <a href="{{ url_for('listar_grupos') }}" class="btn btn-secondary">‚ùå Cancelar</a>
        </div>
    </form>
</div>

<!-- Informa√ß√µes adicionais -->
<div class="card" style="margin-top: 20px; background: #f8f9fa;">
    <h3 style="margin-bottom: 15px; font-size: 18px;">‚ÑπÔ∏è Informa√ß√µes sobre Grupos</h3>
    <ul style="line-height: 1.8; color: #666;">
        <li><strong>C√≥digo do Grupo:</strong> Identificador √∫nico, use abrevia√ß√µes claras (ex: CONT, FIS, RH)</li>
        <li><strong>Nome do Grupo:</strong> Descri√ß√£o completa do tipo de tarefa (ex: Contabilidade, Fiscal, Recursos Humanos)</li>
        <li><strong>Departamento:</strong> Agrupa tarefas por √°rea/setor da empresa para facilitar relat√≥rios e an√°lises</li>
        <li><strong>Organiza√ß√£o:</strong> Use grupos para categorizar tarefas similares e facilitar relat√≥rios</li>
        <li><strong>Vincula√ß√£o:</strong> Cada tarefa deve estar associada a um grupo para melhor controle</li>
    </ul>
    
    <div style="margin-top: 20px; padding: 15px; background: white; border-radius: 8px; border-left: 4px solid #FFD500;">
        <strong>üí° Exemplos de Departamentos:</strong>
        <div style="margin-top: 10px; display: flex; flex-wrap: wrap; gap: 8px;">
            <span class="badge badge-info">Contabilidade</span>
            <span class="badge badge-info">Fiscal</span>
            <span class="badge badge-info">Recursos Humanos</span>
            <span class="badge badge-info">Departamento Pessoal</span>
            <span class="badge badge-info">Societ√°rio</span>
            <span class="badge badge-info">Consultoria</span>
            <span class="badge badge-info">Auditoria</span>
            <span class="badge badge-info">Financeiro</span>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function validarFormulario() {
    const codigo = document.getElementById('cod_grupo_tarefa').value.trim();
    const nome = document.getElementById('nome_grupo_tarefa').value.trim();
    
    if (!codigo || !nome) {
        alert('‚ö†Ô∏è Por favor, preencha todos os campos obrigat√≥rios.');
        return false;
    }
    
    return true;
}

// Auto-formatar c√≥digo (remover espa√ßos)
document.getElementById('cod_grupo_tarefa').addEventListener('input', function(e) {
    this.value = this.value.replace(/\s+/g, '');
});
</script>
{% endblock %}